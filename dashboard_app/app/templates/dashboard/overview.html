{% extends "base.html" %}

{% block title %}Dashboard Overview{% endblock %}

{% block content %}
<div class="dashboard-container">
    <!-- Header Section -->
    <div class="row mb-4" data-aos="fade-down">
        <div class="col-12">
            <div class="page-header">
                <div>
                    <h1 class="display-5 fw-bold mb-2">
                        <i class="bi bi-speedometer2 text-primary"></i> Dashboard Overview
                    </h1>
                    <p class="text-muted lead mb-0">Real-time analytics and insights</p>
                </div>
                <div class="header-actions">
                    <button class="btn btn-outline-primary btn-icon-text" id="refreshData">
                        <i class="bi bi-arrow-clockwise"></i> Refresh
                    </button>
                    <button class="btn btn-primary btn-icon-text">
                        <i class="bi bi-download"></i> Export
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- KPI Metrics Cards -->
    <div class="row g-4 mb-4">
        <div class="col-xl-3 col-md-6" data-aos="fade-up" data-aos-delay="100">
            <div class="metric-card metric-card-primary">
                <div class="metric-icon">
                    <i class="bi bi-box-seam"></i>
                </div>
                <div class="metric-content">
                    <h6 class="metric-label">Total Products</h6>
                    <h2 class="metric-value">{{ stats.total_products|format_number }}</h2>
                    <div class="metric-trend trend-up">
                        <i class="bi bi-arrow-up"></i> 12.5% vs last month
                    </div>
                </div>
                <div class="metric-sparkline">
                    <canvas id="sparkline1" height="50"></canvas>
                </div>
            </div>
        </div>
        
        <div class="col-xl-3 col-md-6" data-aos="fade-up" data-aos-delay="200">
            <div class="metric-card metric-card-success">
                <div class="metric-icon">
                    <i class="bi bi-building"></i>
                </div>
                <div class="metric-content">
                    <h6 class="metric-label">Total Suppliers</h6>
                    <h2 class="metric-value">{{ stats.total_suppliers|format_number }}</h2>
                    <div class="metric-trend trend-up">
                        <i class="bi bi-arrow-up"></i> 8.3% vs last month
                    </div>
                </div>
                <div class="metric-sparkline">
                    <canvas id="sparkline2" height="50"></canvas>
                </div>
            </div>
        </div>
        
        <div class="col-xl-3 col-md-6" data-aos="fade-up" data-aos-delay="300">
            <div class="metric-card metric-card-warning">
                <div class="metric-icon">
                    <i class="bi bi-cash-stack"></i>
                </div>
                <div class="metric-content">
                    <h6 class="metric-label">Total Sales</h6>
                    <h2 class="metric-value">₹{{ "%.1f"|format(stats.total_sales_millions) }}M</h2>
                    <div class="metric-trend trend-up">
                        <i class="bi bi-arrow-up"></i> 12.8% vs last month
                    </div>
                </div>
                <div class="metric-sparkline">
                    <canvas id="sparkline3" height="50"></canvas>
                </div>
            </div>
        </div>
        
        <div class="col-xl-3 col-md-6" data-aos="fade-up" data-aos-delay="400">
            <div class="metric-card metric-card-purple" style="--card-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                <div class="metric-icon">
                    <i class="bi bi-box2-heart-fill"></i>
                </div>
                <div class="metric-content">
                    <h6 class="metric-label">Units Sold</h6>
                    <h2 class="metric-value counter" data-target="{{ stats.total_reviews }}">0</h2>
                    <div class="metric-trend trend-up">
                        <i class="bi bi-arrow-up"></i> 18.3% vs last month
                    </div>
                </div>
                <div class="metric-sparkline">
                    <canvas id="sparkline4" height="50"></canvas>
                </div>
            </div>
        </div>
    </div>

    <!-- Charts Section -->
    <div class="row g-4 mb-4">
        <!-- 3D Bar Chart -->
        <div class="col-xl-8" data-aos="fade-right">
            <div class="chart-card">
                <div class="chart-header">
                    <div>
                        <h5 class="chart-title">
                            <i class="bi bi-bar-chart-fill text-primary"></i> Price Distribution Analysis
                        </h5>
                        <p class="chart-subtitle">Product pricing trends across categories</p>
                    </div>
                    <div class="chart-controls">
                        <div class="btn-group btn-group-sm" role="group">
                            <button type="button" class="btn btn-outline-secondary active">Week</button>
                            <button type="button" class="btn btn-outline-secondary">Month</button>
                            <button type="button" class="btn btn-outline-secondary">Year</button>
                        </div>
                    </div>
                </div>
                <div class="chart-body">
                    <canvas id="priceDistChart" height="300"></canvas>
                </div>
            </div>
        </div>
        
        <!-- 3D Doughnut Chart -->
        <div class="col-xl-4" data-aos="fade-left">
            <div class="chart-card">
                <div class="chart-header">
                    <div>
                        <h5 class="chart-title">
                            <i class="bi bi-pie-chart-fill text-success"></i> Rating Distribution
                        </h5>
                        <p class="chart-subtitle">Customer satisfaction metrics</p>
                    </div>
                </div>
                <div class="chart-body">
                    <canvas id="ratingDistChart" height="300"></canvas>
                </div>
            </div>
        </div>
    </div>

    <!-- Location & Category Charts -->
    <div class="row g-4 mb-4">
        <!-- Suppliers by Location -->
        <div class="col-xl-8" data-aos="fade-up">
            <div class="chart-card">
                <div class="chart-header">
                    <div>
                        <h5 class="chart-title">
                            <i class="bi bi-geo-alt-fill text-danger"></i> Suppliers by Location
                        </h5>
                        <p class="chart-subtitle">Geographic distribution of suppliers</p>
                    </div>
                    <div class="chart-controls">
                        <select class="form-select form-select-sm" style="width: 150px;">
                            <option>All Regions</option>
                            <option>North</option>
                            <option>South</option>
                            <option>East</option>
                            <option>West</option>
                        </select>
                    </div>
                </div>
                <div class="chart-body">
                    <canvas id="locationChart" height="280"></canvas>
                </div>
            </div>
        </div>
        
        <!-- Product Categories -->
        <div class="col-xl-4" data-aos="fade-up" data-aos-delay="100">
            <div class="chart-card">
                <div class="chart-header">
                    <div>
                        <h5 class="chart-title">
                            <i class="bi bi-tags-fill text-warning"></i> Top Categories
                        </h5>
                        <p class="chart-subtitle">Most popular product categories</p>
                    </div>
                </div>
                <div class="chart-body">
                    <canvas id="categoryChart" height="280"></canvas>
                </div>
            </div>
        </div>
    </div>

    <!-- Top Products Section -->
    <div class="row g-4 mb-4" data-aos="fade-up">
        <div class="col-12">
            <div class="chart-card">
                <div class="chart-header">
                    <div>
                        <h5 class="chart-title">
                            <i class="bi bi-currency-dollar text-success"></i> Most Profitable Products
                        </h5>
                        <p class="chart-subtitle">Highest margin products this month</p>
                    </div>
                    <a href="{{ url_for('dashboard.products') }}" class="btn btn-sm btn-outline-primary">
                        View All <i class="bi bi-arrow-right"></i>
                    </a>
                </div>
                <div class="chart-body">
                    <div class="product-grid">
                        {% for product in top_products %}
                        <div class="product-item" data-aos="zoom-in" data-aos-delay="{{ loop.index * 50 }}">
                            <a href="{{ url_for('dashboard.product_detail', product_id=product['Product Identifier']) }}" class="product-link">
                                <div class="product-image-wrapper">
                                    <img src="{{ product.Image }}" alt="{{ product.Title }}" class="product-img">
                                    <div class="product-overlay">
                                        <span class="view-details">View Details</span>
                                    </div>
                                </div>
                                <div class="product-details">
                                    <h6 class="product-name" title="{{ product.Title }}">{{ product.Title[:40] }}{% if product.Title|length > 40 %}...{% endif %}</h6>
                                    <div class="product-meta">
                                        <span class="product-price">₹{{ "%.0f"|format(product.Price) }}</span>
                                        <span class="product-rating">
                                            <i class="bi bi-star-fill"></i> {{ "%.1f"|format(product.Ratings) }}
                                        </span>
                                    </div>
                                    <div class="product-reviews">{{ product.Review }} reviews</div>
                                </div>
                            </a>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Top Suppliers Table -->
    <div class="row g-4 mb-4" data-aos="fade-up">
        <div class="col-12">
            <div class="chart-card">
                <div class="chart-header">
                    <div>
                        <h5 class="chart-title">
                            <i class="bi bi-award-fill text-primary"></i> Top Suppliers
                        </h5>
                        <p class="chart-subtitle">Leading suppliers by performance</p>
                    </div>
                    <a href="{{ url_for('dashboard.suppliers') }}" class="btn btn-sm btn-outline-primary">
                        View All <i class="bi bi-arrow-right"></i>
                    </a>
                </div>
                <div class="chart-body p-0">
                    <div class="table-responsive">
                        <table class="table modern-table">
                            <thead>
                                <tr>
                                    <th width="80">Rank</th>
                                    <th>Supplier Name</th>
                                    <th>Location</th>
                                    <th>Rating</th>
                                    <th>Reviews</th>
                                    <th>Contact</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for supplier in top_suppliers %}
                                <tr class="table-row-hover">
                                    <td>
                                        <span class="rank-badge rank-{{ loop.index }}">
                                            {% if loop.index == 1 %}
                                                <i class="bi bi-trophy-fill"></i>
                                            {% elif loop.index == 2 %}
                                                <i class="bi bi-award-fill"></i>
                                            {% elif loop.index == 3 %}
                                                <i class="bi bi-gem"></i>
                                            {% else %}
                                                {{ loop.index }}
                                            {% endif %}
                                        </span>
                                    </td>
                                    <td>
                                        <div class="supplier-info">
                                            <strong>{{ supplier['Supplier Name'] }}</strong>
                                        </div>
                                    </td>
                                    <td>
                                        <span class="location-badge">
                                            <i class="bi bi-geo-alt-fill"></i> {{ supplier.Location }}
                                        </span>
                                    </td>
                                    <td>
                                        <span class="rating-badge">
                                            <i class="bi bi-star-fill"></i> {{ "%.1f"|format(supplier.Rating) }}
                                        </span>
                                    </td>
                                    <td><span class="text-muted">{{ supplier.Reviews }}</span></td>
                                    <td><code class="contact-code">{{ supplier['Contact Phone'] }}</code></td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', filename='js/charts.js') }}"></script>
<script>
    // Initialize charts and animations on page load
    document.addEventListener('DOMContentLoaded', function() {
        // Counter animation
        animateCounters();
        
        // Load chart data with 3D effects
        loadOverviewCharts();
        
        // Create sparklines
        createSparklines();
        
        // Refresh data button
        document.getElementById('refreshData')?.addEventListener('click', function() {
            this.classList.add('rotating');
            setTimeout(() => {
                this.classList.remove('rotating');
                location.reload();
            }, 1000);
        });
    });
</script>
{% endblock %}
